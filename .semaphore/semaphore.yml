version: v1.0
name: Run in Docker
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
  containers:
    - name: main
      image: 'node:20'
    - name: database
      image: 'registry.semaphoreci.com/postgres:11'
blocks:
  - name: Capture Gmail Screenshot
    task:
      jobs:
        - name: Install Dependencies and Capture Screenshot
          commands:
            - checkout
            - 'echo "deb http://deb.debian.org/debian/ buster main" | tee /etc/apt/sources.list'
            - 'echo "deb http://security.debian.org/debian-security buster/updates main" | tee -a /etc/apt/sources.list'
            - 'echo "deb http://deb.debian.org/debian/ buster-updates main" | tee -a /etc/apt/sources.list'
            - apt-get update
            - apt-get install -y chromium
            - apt-get install -y xvfb python3 python3-pip
            - pip3 install selenium
            - |
              python3 capture_gmail_screenshot.py
